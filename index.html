<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>UPC-A Generator</title>

<!-- JsBarcode -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
<!-- jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#0f1115;
  --card:#161a22;
  --stroke:#262c3a;
  --input:#0f1320;
  --text:#e9edf5;
  --blue:#2b6cff;
}

body{
  margin:0;
  padding:24px;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

.card{
  max-width:1100px;
  margin:auto;
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:16px;
  padding:18px;
}

h1{ margin:0 0 14px; font-size:20px; }

.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}

input{
  flex:1;
  min-width:220px;
  background:var(--input);
  border:1px solid #2a3142;
  color:var(--text);
  border-radius:12px;
  padding:12px 14px;
  font-size:16px;
}

button{
  padding:12px 14px;
  border-radius:12px;
  border:0;
  background:var(--blue);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button.secondary{
  background:#252a36;
  border:1px solid #323a4c;
}
button:disabled{
  opacity:.5;
  cursor:not-allowed;
}

/* barcode */
#barcodeBox{
  display:none;
  margin-top:20px;
  padding:12px;
  background:#fff;
  border:2px solid #000;
  border-radius:12px;
  width:100%;
}

#svgBarcode{
  display:block;
  width:100%;
  height:auto;
}

.meta{
  margin-top:14px;
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  font-size:13px;
  opacity:.85;
}

.mono{
  font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
}
</style>
</head>

<body>
<div class="card">
  <h1>Badge Barcode Generator</h1>

  <div class="row">
    <input id="idInput" class="mono" placeholder="Employee ID (digits only)">
    <button id="btnGen">Generate</button>
    <button id="btnPdf" class="secondary" disabled>PDF</button>
    <button id="btnJpg" class="secondary" disabled>JPG</button>
  </div>

  <div id="barcodeBox">
    <svg id="svgBarcode"></svg>
  </div>

  <div class="meta">
    <div class="mono">UPC-A: <span id="textOut">—</span></div>
    <div>Developed by <strong>Gary Evrisov</strong></div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);

const input = $("idInput");
const svg = $("svgBarcode");
const box = $("barcodeBox");
const out = $("textOut");
const btnPdf = $("btnPdf");
const btnJpg = $("btnJpg");

let currentUPC = "";

/* ---------- UPC-A helpers ---------- */
function digitsOnly(v){ return (v||"").replace(/\D+/g,""); }

function checkDigit(first11){
  let odd=0, even=0;
  for(let i=0;i<11;i++){
    const d = first11.charCodeAt(i)-48;
    (i%2===0)? odd+=d : even+=d;
  }
  return (10 - ((odd*3+even)%10)) % 10;
}

function buildUPC(raw){
  const d = digitsOnly(raw);
  if(!d) return "";
  if(d.length===12) return d;
  const base = d.padStart(11,"0").slice(-11);
  return base + checkDigit(base);
}

/* ---------- render ---------- */
function render(){
  const raw = input.value;
  const upc = buildUPC(raw);

  if(!upc){
    box.style.display="none";
    out.textContent="—";
    btnPdf.disabled=true;
    btnJpg.disabled=true;
    return;
  }

  currentUPC = upc;
  out.textContent = currentUPC;
  box.style.display="block";

  while(svg.firstChild) svg.removeChild(svg.firstChild);

  JsBarcode(svg, currentUPC, {
    format:"upc",
    displayValue:false,
    flat:true,
    height:60,
    width:2,
    margin:0,
    background:"#fff",
    lineColor:"#000"
  });

  /* === MAKE SVG RESPONSIVE === */
  svg.removeAttribute("width");
  svg.removeAttribute("height");
  const bb = svg.getBBox();
  svg.setAttribute("viewBox", `0 0 ${bb.width} ${bb.height}`);
  svg.setAttribute("preserveAspectRatio","xMidYMid meet");

  btnPdf.disabled=false;
  btnJpg.disabled=false;
}

/* ---------- PDF ---------- */
function downloadPDF(){
  if(!currentUPC) return;
  const { jsPDF } = window.jspdf;
  const r = box.getBoundingClientRect();
  const pdf = new jsPDF({unit:"pt", format:[r.width*0.75,r.height*0.75]});

  const xml = new XMLSerializer().serializeToString(box);
  const img = new Image();
  img.onload = ()=>{
    const c=document.createElement("canvas");
    c.width=img.width; c.height=img.height;
    const ctx=c.getContext("2d");
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,c.width,c.height);
    ctx.drawImage(img,0,0);
    pdf.addImage(c.toDataURL("image/png"),"PNG",0,0,pdf.internal.pageSize.getWidth(),pdf.internal.pageSize.getHeight());
    pdf.save(`UPC-A_${currentUPC}.pdf`);
  };
  img.src=URL.createObjectURL(new Blob([xml],{type:"image/svg+xml"}));
}

/* ---------- JPG 600 DPI ---------- */
function downloadJPG(){
  if(!currentUPC) return;
  const r = box.getBoundingClientRect();
  const DPI=600;
  const w=Math.round((r.width/96)*DPI);
  const h=Math.round((r.height/96)*DPI);

  const xml=new XMLSerializer().serializeToString(box);
  const img=new Image();
  img.onload=()=>{
    const c=document.createElement("canvas");
    c.width=w; c.height=h;
    const ctx=c.getContext("2d");
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,w,h);
    ctx.drawImage(img,0,0,w,h);
    const a=document.createElement("a");
    a.href=c.toDataURL("image/jpeg",1);
    a.download=`UPC-A_${currentUPC}_600dpi.jpg`;
    a.click();
  };
  img.src=URL.createObjectURL(new Blob([xml],{type:"image/svg+xml"}));
}

$("btnGen").onclick=render;
btnPdf.onclick=downloadPDF;
btnJpg.onclick=downloadJPG;
input.addEventListener("keydown",e=>{ if(e.key==="Enter") render(); });
</script>
</body>
</html>
